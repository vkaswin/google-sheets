import{r as d,_ as w,j as a,l as Oe}from"./index-ba7c151b.js";import{u as Ve}from"./useSheet-c9dae6c7.js";import"./index-1d071ac4.js";import"./Sheet-62734aa1.js";const Me=d.lazy(()=>w(()=>import("./ColumnResizer-4d3697a9.js"),["assets/ColumnResizer-4d3697a9.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),Be=d.lazy(()=>w(()=>import("./RowResizer-088325aa.js"),["assets/RowResizer-088325aa.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),Ge=d.lazy(()=>w(()=>import("./HighLightSearchCells-c2a39ad2.js"),["assets/HighLightSearchCells-c2a39ad2.js","assets/index-ba7c151b.js","assets/index-c900f067.css","assets/index-4b965531.js"])),oe=d.lazy(()=>w(()=>import("./HighLightCell-b9c5ff06.js"),["assets/HighLightCell-b9c5ff06.js","assets/index-ba7c151b.js","assets/index-c900f067.css","assets/index-4b965531.js"])),Xe=d.lazy(()=>w(()=>import("./HighLightColumn-66b6e7f7.js"),["assets/HighLightColumn-66b6e7f7.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),Ye=d.lazy(()=>w(()=>import("./HighLightRow-ea1f19f4.js"),["assets/HighLightRow-ea1f19f4.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),$e=d.lazy(()=>w(()=>import("./ColumnOverLay-00ad75b0.js"),["assets/ColumnOverLay-00ad75b0.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),xe=d.lazy(()=>w(()=>import("./RowOverLay-0e66f1f0.js"),["assets/RowOverLay-0e66f1f0.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),ne=d.lazy(()=>w(()=>import("./ScrollBar-b1ae199f.js"),["assets/ScrollBar-b1ae199f.js","assets/index-ba7c151b.js","assets/index-c900f067.css","assets/index-4b965531.js"])),Ne=d.lazy(()=>w(()=>import("./EditCell-3dfd1a4c.js"),["assets/EditCell-3dfd1a4c.js","assets/index-ba7c151b.js","assets/index-c900f067.css","assets/index-4b965531.js"])),Ke=d.lazy(()=>w(()=>import("./ContextMenu-5d6fe660.js"),["assets/ContextMenu-5d6fe660.js","assets/index-ba7c151b.js","assets/index-c900f067.css","assets/popper-f3391c26.js"])),qe=d.lazy(()=>w(()=>import("./AutoFill-fadaf070.js"),["assets/AutoFill-fadaf070.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),Je=d.lazy(()=>w(()=>import("./Loader-43ed7cd7.js"),["assets/Loader-43ed7cd7.js","assets/index-ba7c151b.js","assets/index-c900f067.css"])),tt=()=>{const _=d.useRef(null),h=d.useRef(null),re=d.useRef(null),ie=d.useRef(null),{grid:v,config:r,scale:x,isLoading:se,syncState:N,editCell:k,selectedCell:f,selectedColumn:p,selectedRow:R,highLightCells:F,contextMenuRect:K,copiedCell:L,activeHighLightIndex:W,setGrid:de,getCellById:D,getColumnById:q,getRowById:J,setContextMenuRect:H,setSelectedCellId:P,setEditCell:z,setCopyCellId:ae,setSelectedColumnId:M,setSelectedRowId:B,handleDeleteCell:ue,handleDeleteColumn:ce,handleDeleteRow:he,handleInsertColumn:fe,handleInsertRow:ge,handleCopyCell:Q,handleCutCell:me,handlePasteCell:U,handleResizeRow:we,handleResizeColumn:_e,handleAutoFillCell:Ie}=Ve();let{rows:y,columns:S,cells:G}=v;d.useEffect(()=>{ve()},[]),d.useEffect(()=>(window.addEventListener("keydown",le),()=>{window.removeEventListener("keydown",le)}),[f,L]),d.useEffect(()=>{N&&j()},[N]),d.useEffect(()=>(window.addEventListener("resize",j),()=>{window.removeEventListener("resize",j)}),[v]),d.useEffect(()=>{!f&&!p&&!R||Z(y,S)},[f,p,R]),d.useEffect(()=>{Ae()},[W]),d.useLayoutEffect(()=>{Ce()},[v]);const ve=async()=>{await document.fonts.ready,j()},j=()=>{if(!_.current||!h.current)return;let{clientWidth:e,clientHeight:t}=_.current,l=h.current;l.width=e,l.height=t;let{rowId:n,y:o}=y[0]??{},{columnId:i,x:s}=S[0]??{};T({offsetX:s,offsetY:o,rowStart:n,colStart:i})},Ce=()=>{if(!h.current||!v.cells.length&&!v.columns.length&&!v.rows.length)return;let{clientWidth:e,clientHeight:t}=h.current,l=h.current.getContext("2d");l.clearRect(0,0,e,t),l.setTransform(x,0,0,x,0,0),pe(l,v.cells),Z(v.rows,v.columns)},pe=(e,t)=>{for(let l of t)Te(e,l)},Re=(e,t,{height:l,rowId:n,width:o,x:i,y:s})=>{X(e,t?"#D3E3FD":"#FFFFFF",{height:l,width:o,x:i,y:s}),e.save(),e.strokeStyle=r.strokeStyle,e.lineWidth=r.lineWidth,e.textAlign="center",e.textBaseline="middle",e.font="12px Open Sans Medium",e.fillStyle=t?"#000000":"#575a5a",e.beginPath(),e.moveTo(i,s+l),e.lineTo(i+o,s+l),e.stroke(),e.fillText(n.toString(),i+o/2+1,s+l/2+1),e.restore()},ye=(e,t,{columnId:l,height:n,width:o,x:i,y:s})=>{X(e,t?"#D3E3FD":"#FFFFFF",{height:n,width:o,x:i,y:s}),e.save(),e.strokeStyle=r.strokeStyle,e.lineWidth=r.lineWidth,e.textAlign="center",e.textBaseline="middle",e.font="12px Open Sans Medium",e.fillStyle=t?"#000000":"#575a5a",e.beginPath(),e.moveTo(i+o,s),e.lineTo(i+o,s+n),e.stroke(),e.fillText(Oe(l),i+o/2+1,s+n/2+1),e.restore()},X=(e,t,{x:l,y:n,height:o,width:i})=>{e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(l,n),e.fillRect(l,n,i,o),e.fill(),e.restore()},Se=(e,{height:t,width:l,x:n,y:o})=>{e.save(),e.strokeStyle=r.strokeStyle,e.lineWidth=r.lineWidth,e.beginPath(),e.moveTo(n,o+t),e.lineTo(n+l,o+t),e.lineTo(n+l,o),e.stroke(),e.restore()},Ee=(e,t,{height:l,width:n,x:o,y:i})=>{if(!h.current||!(t!=null&&t.length))return;const s=20;let c=o+5,u=i+s;for(let E of t){if(E.insert===`
`){u+=s,c=o+5;continue}let{attributes:{strike:C=!1,color:g="#000000",bold:m=!1,italic:I=!1,underline:b=!1,font:Y="open-sans",size:A="15px"}={},insert:O}=E;e.save();let V="";e.fillStyle=g,m&&(V+="bold "),I&&(V+="italic "),V+=`${A} ${r.fonts[Y]}`,e.font=V;let{width:$}=e.measureText(O);e.fillText(O,c,u),(b||C)&&(e.save(),e.lineWidth=.7,e.strokeStyle=g||"#000000",b&&e.strokeRect(c,u+2,$,0),C&&e.strokeRect(c,u-5,$,0),e.restore()),c+=$,e.restore()}},Te=(e,{cellId:t,rowId:l,columnId:n,height:o,width:i,x:s,y:c})=>{let{background:u="#FFFFFF",content:E=[]}=D(t)??{},C={x:s,y:c,width:i,height:o};X(e,u,C),Ee(e,E,C),Se(e,C)},ke=()=>{if(!h.current)return;let e=h.current.getContext("2d");e.save(),e.fillStyle="#FFFFFF",e.strokeStyle=r.strokeStyle,e.lineWidth=r.lineWidth-.5,e.beginPath(),e.moveTo(0,0),e.fillRect(0,0,r.colWidth,r.rowHeight),e.beginPath(),e.moveTo(0,0),e.strokeRect(0,1,r.colWidth,r.rowHeight-1),e.stroke(),e.restore()},We=e=>{if(!h.current||!e.length)return;let t=h.current.getContext("2d"),l=f==null?void 0:f.rowId;for(let n of e){let o=n.rowId===l||!!p;Re(t,o,n)}t.save(),t.strokeStyle=r.strokeStyle,t.lineWidth=r.lineWidth-.5,t.beginPath(),t.moveTo(0,r.rowHeight),t.lineTo(0,h.current.clientHeight),t.stroke(),t.beginPath(),t.moveTo(r.colWidth,r.rowHeight),t.lineTo(r.colWidth,h.current.clientHeight),t.stroke(),t.restore()},De=e=>{if(!h.current||!e.length)return;let t=h.current.getContext("2d"),l=f==null?void 0:f.columnId;for(let n of e){let o=n.columnId===l||!!R;ye(t,o,n)}t.save(),t.beginPath(),t.strokeStyle=r.strokeStyle,t.lineWidth=r.lineWidth-.5,t.moveTo(r.colWidth,r.rowHeight),t.lineTo(h.current.clientWidth,r.rowHeight),t.stroke(),t.beginPath(),t.moveTo(r.colWidth,1),t.lineTo(h.current.clientWidth,1),t.stroke(),t.restore()},Z=(e,t)=>{We(e),De(t),ke()},T=({offsetX:e=r.colWidth,offsetY:t=r.rowHeight,rowStart:l=1,colStart:n=1})=>{var E,C;if(!_.current)return;let{clientWidth:o,clientHeight:i}=_.current,s=[],c=[],u=[];for(let g=l,m=t;m<i;g++){let I=((E=J(g))==null?void 0:E.height)||r.cellHeight;m+I>r.rowHeight&&s.push({y:m,x:0,rowId:g,height:I,width:r.colWidth}),m+=I}for(let g=n,m=e;m<o;g++){let I=((C=q(g))==null?void 0:C.width)||r.cellWidth;m+I>r.colWidth&&c.push({x:m,y:0,columnId:g,width:I,height:r.rowHeight}),m+=I}for(let{rowId:g,height:m,y:I}of s)for(let{width:b,x:Y,columnId:A}of c){let O=`${A},${g}`;u.push({x:Y,y:I,rowId:g,columnId:A,width:b,height:m,cellId:O})}de({cells:u,columns:c,rows:s})},Fe=e=>{var i;if(!_||!y.length||!S.length)return;let{rowId:t,y:l}=y[0],{columnId:n,x:o}=S[0];if(e<0){for(l+=-e,t--;t>0&&l>r.rowHeight;)l-=((i=J(t))==null?void 0:i.height)??r.cellHeight,t--;let s=Math.min(r.rowHeight,l);T({offsetX:o,offsetY:s,rowStart:t+1,colStart:n})}else T({offsetX:o,offsetY:l+-e,rowStart:t,colStart:n})},Le=e=>{var i;if(!_||!y.length||!S.length)return;let{rowId:t,y:l}=y[0],{columnId:n,x:o}=S[0];if(e<0){for(o+=-e,n--;n>0&&o>r.colWidth;)o-=((i=q(n))==null?void 0:i.width)??r.cellWidth,n--;T({offsetX:Math.min(r.colWidth,o),offsetY:l,rowStart:t,colStart:n+1})}else T({offsetX:o+-e,offsetY:l,rowStart:t,colStart:n})},He=e=>{let{deltaX:t,deltaY:l}=e;t===0?Fe(l):Le(t)},ee=e=>{if(!_.current)return;let{left:t,top:l}=_.current.getBoundingClientRect(),n=e.pageX-t,o=e.pageY-l,i=te(n,o);i&&(P(i),z(null),M(null),B(null),H(null))},te=(e,t)=>{let{rows:l,columns:n}=v,o=0,i=l.length-1,s=null;for(;o<=i;){let u=Math.floor((o+i)/2);l[u].y<=t?(o=u+1,s=l[u].rowId):i=u-1}if(!s)return null;o=0,i=n.length-1;let c=null;for(;o<=i;){let u=Math.floor((o+i)/2);n[u].x<=e?(o=u+1,c=n[u].columnId):i=u-1}return c?`${c},${s}`:null},Pe=e=>{e.preventDefault(),ee(e),H({x:e.pageX,y:e.pageY})},ze=()=>{if(!_.current||!f)return;let{columnId:e,cellId:t,width:l,height:n,rowId:o,x:i,y:s}=f,{top:c}=_.current.getBoundingClientRect();P(null),ae(null),z({cellId:t,columnId:e,width:l,height:n,rowId:o,x:Math.max(r.colWidth,i),y:Math.max(r.rowHeight+c,s+c)})},je=e=>{M(e),B(null),P(null),z(null),H(null)},be=e=>{B(e),M(null),P(null),z(null),H(null)},Ae=()=>{if(!F.length||W===null)return;let e=D(F[W]);!e||G.some(l=>l.rowId===e.rowId&&l.columnId===e.columnId)||T({rowStart:e.rowId,colStart:e.columnId})},le=e=>{if(!f)return;let{ctrlKey:t,key:l}=e;t&&l==="c"?Q():t&&l==="v"&&U()};return a.jsxs(d.Fragment,{children:[a.jsxs("div",{ref:_,className:"relative w-[var(--grid-width)] h-[var(--grid-height)] select-none overflow-hidden",onWheel:He,onMouseDown:ee,onContextMenu:Pe,onDoubleClick:ze,children:[se&&a.jsx(Je,{}),a.jsx("canvas",{ref:h}),a.jsx(ne,{ref:re,axis:"y"}),a.jsx(ne,{ref:ie,axis:"x"}),p&&a.jsx(Xe,{column:p}),R&&a.jsx(Ye,{row:R}),a.jsxs("div",{className:"absolute left-[var(--col-width)] top-[var(--row-height)] w-[calc(100%-var(--col-width))] h-[calc(100%-var(--row-height))] overflow-hidden",children:[L&&a.jsx(oe,{cell:L,dashed:!0}),f&&!k&&f!==L&&a.jsxs(d.Fragment,{children:[a.jsx(oe,{cell:f}),a.jsx(qe,{cells:G,gridRef:_,selectedCell:f,getCellById:D,onAutoFillCell:Ie,getCellIdByCoordiantes:te})]}),p&&a.jsx($e,{column:p}),R&&a.jsx(xe,{row:R}),!!F.length&&W!==null&&a.jsx(Ge,{cells:G,highLightCells:F,activeHighLightIndex:W,getCellById:D})]}),a.jsx(Me,{columns:S,onClick:je,onResize:_e}),a.jsx(Be,{rows:y,onClick:be,onResize:we})]}),a.jsx(Ne,{cell:k,data:D(k==null?void 0:k.cellId)}),K&&a.jsx(Ke,{rect:K,isCellSelected:!!f,isColumnSelected:!!p,isRowSelected:!!R,onCopy:Q,onCut:me,onPaste:U,onDeleteCell:ue,onDeleteColumn:ce,onDeleteRow:he,onInsertColumn:fe,onInsertRow:ge})]})};export{tt as default};
